<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <header>
    <div class="header-top">
      <a class="title" href="/">Dummy Deals</a>
      <nav>
        <a href="/">Home</a>
        <a href="#">Features</a>
        <a href="#">Pricing</a>
      </nav>
    </div>
    <div class="filter-container">
      <form method="GET" action="/">
        <div class="filter-checkboxes">
          <fieldset>
            <legend style="display:none;">Category</legend>
            <label><input type="checkbox" name="category" value="GPU">GPU</label>
            <label><input type="checkbox" name="category" value="CPU">CPU</label>
            <label><input type="checkbox" name="category" value="Memory">Memory</label>
            <label><input type="checkbox" name="category" value="SSD">SSD</label>
            <label><input type="checkbox" name="category" value="Motherboard">Motherboard</label>
            <label><input type="checkbox" name="category" value="HDD">HDD</label>
          </fieldset>
          <fieldset>
            <legend style="display:none;">Deal Type</legend>
            <label><input type="checkbox" name="deal_type" value="fair">Fair Deal</label>
            <label><input type="checkbox" name="deal_type" value="good">Good Deal</label>
            <label><input type="checkbox" name="deal_type" value="great">Great Deal</label>
          </fieldset>
        </div>
        <div class="filter-buttons">
          <button type="submit">Apply Filters</button>
          <a class="reset-btn" href="/">Reset Filters</a>
        </div>
      </form>
      <!-- Sorting Dropdown (client-side sorting only) -->
      <div class="sort-container" style="margin-top: 10px;">
        <label for="sort_by">Sort by:</label>
        <select id="sort_by">
          <option value="">Default</option>
          <option value="deal_type">Deal Type</option>
          <option value="cpu">CPU Type</option>
          <option value="net_profit">Net Profit</option>
          <option value="price">Price</option>
        </select>
      </div>
    </div>
  </header>
  
  <div class="container">
    {% if deals %}
      {% for deal in deals %}
      {# Determine deal type for data attribute #}
      {% set d_type = 'fair' %}
      {% if deal.net_profit is not none %}
        {% if deal.net_profit < 10 %}
          {% set d_type = 'fair' %}
        {% elif deal.net_profit < 30 %}
          {% set d_type = 'good' %}
        {% else %}
          {% set d_type = 'great' %}
        {% endif %}
      {% endif %}
      <div class="card {% if d_type == 'fair' %}fair-deal-card{% elif d_type == 'good' %}good-deal-card{% else %}great-deal-card{% endif %}"
           data-deal-type="{{ d_type }}"
           data-cpu="{{ deal.cpu_model if deal.cpu_model else deal.title }}"
           data-net-profit="{{ deal.net_profit if deal.net_profit is not none else 0 }}"
           data-price="{{ deal.price }}">
        <div class="card-header {% if d_type == 'fair' %}fair-deal-header{% elif d_type == 'good' %}good-deal-header{% else %}great-deal-header{% endif %}">
          {% if deal.net_profit is not none %}
            {% if deal.net_profit < 10 %}
              Fair Deal
            {% elif deal.net_profit < 30 %}
              Good Deal
            {% else %}
              Great Deal
            {% endif %}
          {% else %}
            Low Sales Data
          {% endif %}
        </div>
        <h2>
          {% if deal.cpu_model %}
            {{ deal.cpu_model }}
          {% else %}
            {{ deal.title }}
          {% endif %}
        </h2>
        <p><strong>Price:</strong> ${{ deal.price }}</p>
        <p>
          <strong>Estimated Sale Price:</strong> 
          {% if deal.estimated_sale_price is not none %}
            ${{ deal.estimated_sale_price }}
          {% else %}
            low sales data
          {% endif %}
        </p>
        <p>
          <strong>Net Profit:</strong> 
          {% if deal.net_profit is not none %}
            ${{ deal.net_profit }}
          {% else %}
            low sales data
          {% endif %}
        </p>
        <p><strong>Condition:</strong> {{ deal.condition }}</p>
        <p><strong>Listed:</strong> {{ deal.post_date }}</p>
        <p><a href="{{ deal.listing_url }}" target="_blank">View Listing</a></p>
      </div>      
      {% endfor %}
    {% else %}
      <p>No good deals found at this time.</p>
    {% endif %}
  </div>
  
  <footer>
    &copy; 2025 Dummy Deals. All Rights Reserved.
  </footer>
  
  <!-- Client-Side Sorting Script -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const sortSelect = document.getElementById('sort_by');
      const container = document.querySelector('.container');

      sortSelect.addEventListener('change', function() {
        const criteria = this.value;
        // Get NodeList of card elements and convert to an array
        const cards = Array.from(container.querySelectorAll('.card'));
        
        let sortedCards;
        
        if (criteria === 'deal_type') {
          // Custom order for deal type: great, good, fair, then low sales data
          const order = { 'great': 0, 'good': 1, 'fair': 2, 'low': 3 };
          sortedCards = cards.sort((a, b) => {
            return order[a.dataset.dealType] - order[b.dataset.dealType];
          });
        } else if (criteria === 'cpu') {
          sortedCards = cards.sort((a, b) => {
            const cpuA = a.dataset.cpu.toLowerCase();
            const cpuB = b.dataset.cpu.toLowerCase();
            if (cpuA < cpuB) return -1;
            if (cpuA > cpuB) return 1;
            return 0;
          });
        } else if (criteria === 'net_profit') {
          sortedCards = cards.sort((a, b) => {
            return parseFloat(b.dataset.netProfit) - parseFloat(a.dataset.netProfit);
          });
        } else if (criteria === 'price') {
          sortedCards = cards.sort((a, b) => {
            return parseFloat(a.dataset.price) - parseFloat(b.dataset.price);
          });
        } else {
          // If "Default" is selected, do nothing (or you could reload original order)
          return;
        }
        
        // Remove all cards from container
        container.innerHTML = "";
        // Append sorted cards
        sortedCards.forEach(card => container.appendChild(card));
      });
    });
  </script>
</body>
</html>
